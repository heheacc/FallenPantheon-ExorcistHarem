<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‡´ë§ˆ ì‹œë®¬ë ˆì´ì…˜: ì´ˆê¸°í™”ë©´</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        
        /* ëª¨ë…¸í†¤/ê³ ë”• ìŠ¤íƒ€ì¼ ê¸°ë³¸ ì„¤ì • */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d0d0d; /* ê·¹ë„ë¡œ ì–´ë‘ìš´ ë°°ê²½ */
            color: #e0e0e0; /* ë°ì€ íšŒìƒ‰ í…ìŠ¤íŠ¸ */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            text-align: center;
        }

        .main-container {
            width: 100%;
            max-width: 1024px; /* ê°€ë¡œ ë°°ì—´ì„ ìœ„í•´ ë„ˆë¹„ í™•ì¥ */
            background-color: #1a1a1a; /* ì»¨í…Œì´ë„ˆ ë°°ê²½ */
            border: 2px solid #333; /* ì–‡ì€ í…Œë‘ë¦¬ */
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            padding: 2.5rem;
            transition: all 0.5s ease;
        }

        .header-title {
            @apply text-5xl font-extrabold mb-4 tracking-widest;
            color: #ff4757; /* ì—‘ì„¼íŠ¸ ìƒ‰ìƒ: ê°•ë ¬í•œ ë¹¨ê°• */
            text-shadow: 0 0 10px rgba(255, 71, 87, 0.4);
        }

        .mono-button {
            @apply px-8 py-3 rounded-md font-bold text-lg transition duration-300 transform hover:scale-[1.03] shadow-lg;
            background-color: #333;
            color: #e0e0e0;
            border: 1px solid #555;
        }

        .mono-button:hover {
            background-color: #444;
            border-color: #ff4757;
            box-shadow: 0 0 15px rgba(255, 71, 87, 0.5);
        }
        
        .accent-button {
            background-color: #ff4757;
            color: #1a1a1a;
        }
        .accent-button:hover {
            background-color: #e63946;
            border-color: #ff4757;
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.8);
        }
        
        /* ìºë¦­í„° ì„ íƒ ê·¸ë¦¬ë“œ (ë°€ì°© ë°°ì—´) */
        #partnerSelectionGrid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4ê°œì˜ ì´ë¯¸ì§€ë¥¼ ê°€ë¡œë¡œ ë°€ì°© */
            gap: 0; /* ì´ë¯¸ì§€ ê°„ê²© ì œê±° */
        }
        
        .partner-card {
            position: relative;
            cursor: pointer;
            transition: all 0.5s ease-in-out;
            border-right: 1px solid #333; /* ê²½ê³„ì„  ì¶”ê°€ */
        }
        .partner-card:last-child {
            border-right: none;
        }

        .partner-image {
            width: 100%;
            height: 300px; /* ì´ë¯¸ì§€ ë†’ì´ ê³ ì • */
            object-fit: cover;
            transition: all 0.5s ease-in-out;
            filter: grayscale(100%) brightness(0.6); /* ê¸°ë³¸ ì–´ë‘¡ê²Œ + í‘ë°± */
        }
        
        .partner-image.active {
            filter: grayscale(0%) brightness(1); /* í™œì„±í™” ì‹œ ì»¬ëŸ¬ + ë°ê²Œ */
            transform: scale(1.05);
            z-index: 10;
        }
        
        /* ì´ë¯¸ì§€ ìœ„ í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ */
        .overlay-text {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 8px 12px;
            text-align: left;
        }
    </style>
</head>
<body>

    <div class="main-container">
        
        <!-- ============================================== -->
        <!-- Page 1: ì„¸ê³„ê´€ ì„¤ëª… ë° ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘ (ì´ˆê¸° í™”ë©´) -->
        <!-- ============================================== -->
        <div id="page-1" class="page-content space-y-8">
            <h1 class="header-title">
                í‡´ë§ˆ ì‹œë®¬ë ˆì´ì…˜: ê·¸ë¦¼ìì˜ ì¥
            </h1>
            
            <p class="text-xl font-semibold text-gray-400 mb-6">
                ì´ë‹¨ê³¼ ì‹ ì„±ì´ êµì°¨í•˜ëŠ” ì„¸ê³„ì—ì„œ, ë‹¹ì‹ ì˜ ì„ íƒì´ ìš´ëª…ì„ ê²°ì •í•©ë‹ˆë‹¤.
            </p>

            <!-- ì‹œë®¬ë ˆì´ì…˜ ì„¤ëª… -->
            <div class="p-5 border border-gray-700 rounded-lg bg-[#222] text-left">
                <h2 class="text-2xl font-bold mb-3 text-red-400">ì‹œë®¬ë ˆì´ì…˜ ê°€ì´ë“œ</h2>
                <ul class="list-disc list-inside space-y-2 text-gray-300">
                    <li>**ì£¼ì œ:** ì—‘ì†Œì‹œì¦˜ê³¼ í‡´ë§ˆë¥¼ ë°°ê²½ìœ¼ë¡œ í•˜ëŠ” ë‹¤í¬ íŒíƒ€ì§€ ë¡œë§¨ìŠ¤ ì‹œë®¬ë ˆì´ì…˜ì…ë‹ˆë‹¤.</li>
                    <li>**íŠ¹ì§•:** ì •í™”ë„/ì˜¤ì—¼ë„ ìƒíƒœì°½, í„´ì œ ì „íˆ¬ ì‹œìŠ¤í…œ (QTE íˆë“  ì´ë²¤íŠ¸ í¬í•¨)ì´ ì¡´ì¬í•©ë‹ˆë‹¤.</li>
                    <li>**ëª©í‘œ:** 4ëª…ì˜ íŒŒíŠ¸ë„ˆ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ê³ , ìˆ˜ë§ì€ ë¹„ì¸ê°„ê³„ ì¡´ì¬ë“¤ê³¼ í˜‘ë ¥ ë˜ëŠ” ì ëŒ€í•˜ë©° ë¯¸ìŠ¤í„°ë¦¬ë¥¼ í•´ê²°í•˜ì„¸ìš”.</li>
                </ul>
            </div>

            <!-- ì™¸ë¶€ HTML ë§í¬ ë²„íŠ¼ (ì„¸ê³„ê´€/ìºë¦­í„°/ì„¤ëª… í˜ì´ì§€) -->
            <div class="pt-4 space-y-4">
                <!-- ğŸ’¡ ST ì™¸ë¶€ì— ì—°ê²°ë  ìƒì„¸ ì„¤ëª… í˜ì´ì§€ ë²„íŠ¼ -->
                <button id="externalLinkBtn" class="mono-button w-full">
                    ğŸ“˜ ì„¸ê³„ê´€ / ë“±ì¥ì¸ë¬¼ / ìƒì„¸ ê·œì¹™ ë³´ê¸° (ì™¸ë¶€ HTML ì—°ê²°)
                </button>
                
                <!-- ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™ ë²„íŠ¼ -->
                <button id="nextPageBtn" class="accent-button mono-button w-full" onclick="showPage('page-2')">
                    ì‹œì‘í•˜ê¸°: íŒŒíŠ¸ë„ˆ ìºë¦­í„° ì„ íƒ â†’
                </button>
            </div>
        </div>

        <!-- ============================================== -->
        <!-- Page 2: ìºë¦­í„° ì„ íƒ ë° WI í† ê¸€ -->
        <!-- ============================================== -->
        <div id="page-2" class="page-content hidden space-y-4">
            <h2 class="text-3xl font-bold text-center border-b border-gray-600 pb-3 text-red-400">
                íŒŒíŠ¸ë„ˆ ì„ íƒ: ì—¬ì •ì„ í•¨ê»˜í•  ì¡°ë ¥ìë¥¼ ê³ ë¥´ì„¸ìš”
            </h2>
            <p class="text-center text-gray-400">
                ì´ë¯¸ì§€ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¤ í”„ë¡¤ë¡œê·¸ë¥¼ í™•ì¸í•˜ê³  í´ë¦­í•˜ì—¬ ì‹œë®¬ë ˆì´ì…˜ì„ ì‹œì‘í•˜ì„¸ìš”.
            </p>
            
            <!-- 1. ìºë¦­í„° ì´ë¯¸ì§€ ê·¸ë¦¬ë“œ (ê°€ë¡œ ë°€ì°©) -->
            <div id="partnerSelectionGrid">
                <!-- ì—¬ê¸°ì— ìºë¦­í„° ë²„íŠ¼ì´ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤. -->
            </div>

            <!-- 2. í”„ë¡¤ë¡œê·¸ ë¯¸ë¦¬ë³´ê¸° (ì´ë¯¸ì§€ ì•„ë˜ì— í‘œì‹œ) -->
            <div id="prologuePreview" class="p-4 bg-[#282828] border border-gray-600 rounded-lg text-left hidden">
                <h3 class="font-bold text-lg text-yellow-400 mb-2">í”„ë¡¤ë¡œê·¸ ìŠ¤í¬ë¦½íŠ¸ ë¯¸ë¦¬ë³´ê¸°:</h3>
                <p id="prologueText" class="text-sm italic text-gray-300"></p>
            </div>
            
            <!-- 3. WI í† ê¸€ ë° ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
            <div class="pt-6 border-t border-gray-700 space-y-4">
                 <button id="toggleWICancelBtn" class="mono-button w-full" onclick="showPage('page-1')">
                    â† ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </button>

                <!-- ë¹„ì¸ê°„ê³„ ìºë¦­í„° WI í† ê¸€ ì˜ì—­ -->
                <button id="toggleWIListBtn" class="mono-button w-full mt-4">
                    ğŸ‘¥ ë¹„ì¸ê°„ê³„ ìºë¦­í„° WI í† ê¸€ ì„¤ì • ë° ì‚¬ìš©ì ì •ì˜ (ì„ íƒ ì‚¬í•­)
                </button>
                <div id="wiToggleArea" class="hidden p-4 mt-2 bg-[#282828] border border-gray-700 rounded-lg grid grid-cols-2 md:grid-cols-3 gap-3">
                    <!-- ì—¬ê¸°ì— WI í† ê¸€ ì²´í¬ë°•ìŠ¤ê°€ ì‚½ì…ë©ë‹ˆë‹¤. -->
                    <div class="md:col-span-3 text-sm text-yellow-500 border-b border-gray-600 pb-2 mb-2">
                        **[ê°œë°œ ê°€ì´ë“œ: ìºë¦­í„° ìœ ë™ì„±]**
                        <ul class="list-disc list-inside ml-4 mt-2 text-xs text-gray-400 space-y-1">
                            <li>**ìºë¦­í„° ì¶”ê°€:** ìƒˆë¡œìš´ ë¹„ì¸ê°„ê³„ ìºë¦­í„°ë¥¼ ì¶”ê°€í•˜ë ¤ë©´, ì´ HTML íŒŒì¼ ë‚´ì˜ `NON_PARTNER_CHARS` ë°°ì—´ì— `{ id: 'ìƒˆID', name: 'ìƒˆì´ë¦„', type: 'ìƒˆíƒ€ì…' }` í˜•ì‹ìœ¼ë¡œ ê°ì²´ë¥¼ ì¶”ê°€í•˜ê³  `renderWIToggleArea()` í•¨ìˆ˜ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.</li>
                            <li>**ST ì—°ë™:** ì¶”ê°€ëœ ìºë¦­í„°ì˜ WI íŒŒì¼ì€ **STì˜ WI í´ë”**ì— ìˆì–´ì•¼ í•˜ë©°, ì´ ì²´í¬ë°•ìŠ¤ ID(`id: 'ìƒˆID'`)ì™€ STì˜ WI íŒŒì¼ ì´ë¦„(í™•ì¥ì ì œì™¸)ì´ **ì •í™•íˆ ì¼ì¹˜**í•´ì•¼ `/run set_wits` ëª…ë ¹ì–´ë¡œ í™œì„±í™”ë©ë‹ˆë‹¤.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- ì „ì—­ ë°ì´í„° ë° ê¸°ëŠ¥ ì„¤ì • ---
        
        // íŒŒíŠ¸ë„ˆ ìºë¦­í„° ì •ë³´ (ì„ì‹œ ë°ì´í„°)
        const PARTNER_CHARS = [
            { id: 'priest', name: 'ìš”í•œ ì‹ ë¶€', type: 'ì²œì£¼êµ ì‚¬ì œ', image: 'https://placehold.co/400x400/1a1a1a/e0e0e0?text=Priest' , prologue: "ì–´ë‘  ì†ì—ì„œ ì†ì£„ë¥¼ êµ¬í•˜ëŠ” í•œ ë‚¨ìì˜ ì´ì•¼ê¸°. ê·¸ì˜ ì„ë¬´ëŠ” íƒ€ë½í•œ ì˜í˜¼ë“¤ì„ êµ¬ì›í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë‹¹ì‹ ì´ ë‚˜íƒ€ë‚˜ë©´ì„œ ê·¸ì˜ ë¯¿ìŒì€ ì‹œí—˜ëŒ€ì— ì˜¤ë¦…ë‹ˆë‹¤..."},
            { id: 'shaman', name: 'ìƒ¤ì¹´ ì£¼ìˆ ì‚¬', type: 'íŒë‘ ì‹ ë¹„ì£¼ì˜ì', image: 'https://placehold.co/400x400/1a1a1a/e0e0e0?text=Shaman' , prologue: "ì‹ ì„±í•œ ë¶ˆê½ƒê³¼ ì£¼ìˆ ì  í˜ìœ¼ë¡œ ì•…ì„ ëª°ì•„ë‚´ëŠ” ì£¼ìˆ ì‚¬. ê°•ë ¬í•œ ì¹´ë¦¬ìŠ¤ë§ˆ ë’¤ì— ìˆ¨ê²¨ì§„ ê·¸ì˜ ê³¼ê±°ì™€ ë¹„ë°€ìŠ¤ëŸ¬ìš´ ì˜ì‹ì„ í•¨ê»˜í•˜ê²Œ ë©ë‹ˆë‹¤."},
            { id: 'exorcist', name: 'í˜„ëŒ€ í‡´ë§ˆì‚¬', type: 'ë™ì–‘ê³„ í‡´ë§ˆ ì „ë¬¸ê°€', image: 'https://placehold.co/400x400/1a1a1a/e0e0e0?text=Exorcist' , prologue: "ë¹ ë¥¸ íŒë‹¨ë ¥ê³¼ í˜„ëŒ€ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ëŠ” ëƒ‰ì² í•œ í‡´ë§ˆì‚¬. ë™ì–‘ì˜ ì˜ë¬¼ë“¤ê³¼ ì–½íŒ ë¯¸ìŠ¤í„°ë¦¬í•œ ì‚¬ê±´ì„ í•´ê²°í•˜ê¸° ìœ„í•´ ë‹¹ì‹ ê³¼ ê³„ì•½ì„ ë§ºìŠµë‹ˆë‹¤."},
            { id: 'cultist', name: 'ì•„ë§ˆì¶”ì–´ ìˆ­ë°°ì', type: 'ì•…ë§ˆ ìˆ­ë°°ì (ì´ˆë³´)', image: 'https://placehold.co/400x400/1a1a1a/e0e0e0?text=Cultist' , prologue: "ì•…ë§ˆë¥¼ ì†Œí™˜í•˜ë ¤ë‹¤ ì‹¤ìˆ˜ë¡œ ë‹¹ì‹ ì„ ë§Œë‚œ ì•„ë§ˆì¶”ì–´ ìˆ­ë°°ì. ìœ„í—˜í•˜ì§€ë§Œ ë§¤í˜¹ì ì¸ ê·¸ì˜ ê¸¸ì— ë™ì°¸í•˜ì—¬ ê¸ˆë‹¨ì˜ ì§€ì‹ì„ íƒêµ¬í•˜ê²Œ ë©ë‹ˆë‹¤."},
        ];

        // ë¹„ì¸ê°„ê³„ ìºë¦­í„° ì •ë³´ (WI í† ê¸€ìš© ì„ì‹œ ë°ì´í„°)
        // ğŸš¨ ìœ ë™ì ì¸ ìºë¦­í„° ì¶”ê°€ë¥¼ ìœ„í•´ ì´ ë°°ì—´ì— ìƒˆ ê°ì²´ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.
        const NON_PARTNER_CHARS = [
            { id: 'michael', name: 'ë¯¸ì¹´ì—˜', type: 'ì²œì‚¬' }, { id: 'uriel', name: 'ìš°ë¦¬ì—˜', type: 'ì²œì‚¬' }, 
            { id: 'lucifer', name: 'ë£¨ì‹œí¼', type: 'íƒ€ì²œì‚¬' }, { id: 'mephisto', name: 'ë©”í”¼ìŠ¤í† ', type: 'ì•…ë§ˆ' },
            { id: 'astaroth', name: 'ì•„ìŠ¤íƒ€ë¡œíŠ¸', type: 'ì•…ë§ˆ' }, { id: 'vishnu', name: 'ë¹„ìŠˆëˆ„', type: 'íŒë‘ì‹ ' }, 
            { id: 'agni', name: 'ì•„ê·¸ë‹ˆ', type: 'íŒë‘ì‹ ' }, { id: 'chouno', name: 'ì²œí˜¸', type: 'ë™ì–‘ì˜ë¬¼' }, 
            { id: 'kirin', name: 'ê¸°ë¦°', type: 'í™˜ìˆ˜' }, { id: 'extra1', name: 'ì´ë‹¨ì', type: 'ì•…ë§ˆ' },
        ];
        
        // í˜„ì¬ í™œì„±í™”ëœ WI ëª©ë¡ (SillyTavernì—ì„œ WIë¥¼ í† ê¸€í•˜ëŠ” ê²ƒì„ ì‹œë®¬ë ˆì´ì…˜)
        let activeWIs = []; 

        /**
         * í™”ë©´ì„ ì „í™˜í•©ë‹ˆë‹¤.
         * @param {string} pageId - í‘œì‹œí•  í˜ì´ì§€ì˜ ID ('page-1', 'page-2')
         */
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(pageId).classList.remove('hidden');

            if (pageId === 'page-2') {
                renderPartnerSelection();
            }
        }
        
        /**
         * íŒŒíŠ¸ë„ˆ ì„ íƒ í˜ì´ì§€ë¥¼ ë™ì ìœ¼ë¡œ ë Œë”ë§í•˜ê³  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
         */
        function renderPartnerSelection() {
            const grid = document.getElementById('partnerSelectionGrid');
            const previewBox = document.getElementById('prologuePreview');
            const previewText = document.getElementById('prologueText');

            grid.innerHTML = PARTNER_CHARS.map(char => `
                <div 
                    class="partner-card"
                    data-id="${char.id}"
                >
                    <img src="${char.image}" alt="${char.name} ì´ë¯¸ì§€" 
                         class="partner-image" data-id="${char.id}">
                    
                    <div class="overlay-text">
                        <span class="text-xl font-bold text-white">${char.name}</span>
                    </div>
                </div>
            `).join('');

            // WI í† ê¸€ ì˜ì—­ ë Œë”ë§
            renderWIToggleArea();
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë¶€ì°©
            document.querySelectorAll('.partner-card').forEach(card => {
                const charId = card.dataset.id;
                const char = PARTNER_CHARS.find(c => c.id === charId);

                // 1. Hover íš¨ê³¼
                card.addEventListener('mouseenter', () => {
                    // í”„ë¡¤ë¡œê·¸ ë°•ìŠ¤ í‘œì‹œ
                    previewText.textContent = char.prologue;
                    previewBox.classList.remove('hidden');

                    // ë‹¤ë¥¸ ì¹´ë“œ ì–´ë‘¡ê²Œ ì²˜ë¦¬ ë° í˜„ì¬ ì¹´ë“œ ê°•ì¡°
                    document.querySelectorAll('.partner-image').forEach(img => {
                        img.classList.remove('active');
                    });
                    card.querySelector('.partner-image').classList.add('active');
                });

                card.addEventListener('mouseleave', () => {
                    // ë§ˆìš°ìŠ¤ê°€ ê·¸ë¦¬ë“œì—ì„œ ë²—ì–´ë‚¬ì„ ë•Œë§Œ ìˆ¨ê¸°ê¸° (ë˜ëŠ” í”„ë¡¤ë¡œê·¸ ë°•ìŠ¤ ìì²´ì—ì„œ ë²—ì–´ë‚¬ì„ ë•Œ)
                    // í˜„ì¬ëŠ” ì´ë¯¸ì§€ì—ì„œ ë²—ì–´ë‚˜ë©´ ë°”ë¡œ ë¹„í™œì„±í™”
                    // previewBox.classList.add('hidden'); // ì¼ë‹¨ ìˆ¨ê¹€ ì²˜ë¦¬í•˜ì§€ ì•Šê³  ë§ˆìš°ìŠ¤ë¥¼ ë—„ ë•Œê¹Œì§€ ìœ ì§€
                });
                
                // ê·¸ë¦¬ë“œ ì „ì²´ì—ì„œ ë§ˆìš°ìŠ¤ê°€ ë²—ì–´ë‚  ë•Œ ë¯¸ë¦¬ë³´ê¸° ìˆ¨ê¸°ê¸°
                grid.addEventListener('mouseleave', () => {
                    previewBox.classList.add('hidden');
                    document.querySelectorAll('.partner-image').forEach(img => {
                        img.classList.remove('active');
                    });
                });


                // 2. Click ì´ë²¤íŠ¸ (ST ì´ˆê¸°í™” ë° ì‹œì‘)
                card.addEventListener('click', () => {
                    startGame(charId);
                });
            });
        }
        
        /**
         * WI í† ê¸€ ì˜ì—­ì„ ë Œë”ë§í•˜ê³  ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
         * ğŸš¨ ìºë¦­í„° ì¶”ê°€ ì‹œ, NON_PARTNER_CHARS ë°°ì—´ë§Œ ìˆ˜ì •í•˜ë©´ ë©ë‹ˆë‹¤.
         */
        function renderWIToggleArea() {
            const wiArea = document.getElementById('wiToggleArea');
            // ê¸°ì¡´ íŠœí† ë¦¬ì–¼ ì˜ì—­ì„ ìœ ì§€í•˜ê³  ê·¸ ì•„ë˜ì— ì²´í¬ë°•ìŠ¤ ì¶”ê°€
            const tutorialGuide = wiArea.querySelector('.md\\:col-span-3');
            let checkboxesHtml = '';

            NON_PARTNER_CHARS.forEach(char => {
                checkboxesHtml += `
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="wi-${char.id}" data-id="${char.id}" 
                               class="form-checkbox h-4 w-4 text-red-500 rounded border-gray-500 bg-gray-700"
                               ${activeWIs.includes(char.id) ? 'checked' : ''}>
                        <label for="wi-${char.id}" class="text-sm text-gray-300">${char.name} (${char.type})</label>
                    </div>
                `;
            });
            
            // íŠœí† ë¦¬ì–¼ ê°€ì´ë“œë¥¼ ì œì™¸í•œ ì˜ì—­ì„ ì—…ë°ì´íŠ¸
            const checkboxContainer = document.createElement('div');
            checkboxContainer.className = "grid grid-cols-2 md:grid-cols-3 gap-3";
            checkboxContainer.innerHTML = checkboxesHtml;
            
            // ê¸°ì¡´ ë‚´ìš© ì œê±° í›„ íŠœí† ë¦¬ì–¼ ê°€ì´ë“œì™€ ì²´í¬ë°•ìŠ¤ ì»¨í…Œì´ë„ˆ ë‹¤ì‹œ ì‚½ì…
            wiArea.innerHTML = '';
            wiArea.appendChild(tutorialGuide);
            wiArea.appendChild(checkboxContainer);

            
            // WI í† ê¸€ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('toggleWIListBtn').addEventListener('click', () => {
                wiArea.classList.toggle('hidden');
            });

            // ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì´ë²¤íŠ¸ -> activeWIs ì—…ë°ì´íŠ¸
            wiArea.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const charId = e.target.dataset.id;
                    if (e.target.checked) {
                        if (!activeWIs.includes(charId)) activeWIs.push(charId);
                    } else {
                        activeWIs = activeWIs.filter(id => id !== charId);
                    }
                    console.log("í˜„ì¬ í™œì„±í™”ëœ WI ID:", activeWIs);
                });
            });
        }

        /**
         * ê²Œì„ ì‹œì‘ ë¡œì§ (ST ì—°ë™ì˜ í•µì‹¬)
         * @param {string} partnerId - ì„ íƒëœ íŒŒíŠ¸ë„ˆ ID
         */
        function startGame(partnerId) {
            const partner = PARTNER_CHARS.find(c => c.id === partnerId);
            
            if (!confirm(`${partner.name}(ì™€)ê³¼ í•¨ê»˜ ì—¬ì •ì„ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ST ìƒíƒœ ì´ˆê¸°í™” ë° ì±„íŒ… ì‹œì‘)`)) {
                return;
            }

            // ====================================================================
            // SillyTavern ì—°ë™ í•µì‹¬ ë¶€ë¶„ (JS Slash Runner ì‚¬ìš©)
            // STì—ì„œ JS Slash Runner í™•ì¥ í”„ë¡œê·¸ë¨ì´ í™œì„±í™”ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
            // ====================================================================
            
            // 1. í™œì„±í™”í•  WI ëª©ë¡ ìƒì„± (íŒŒíŠ¸ë„ˆ WIëŠ” í¬í•¨í•˜ì§€ ì•ŠìŒ. STê°€ ì•Œì•„ì„œ ì²˜ë¦¬)
            const activeWitsString = activeWIs.join(',');

            // 2. ST ìƒíƒœ ì´ˆê¸°í™” ë° í”„ë¡¬í”„íŠ¸ ì „ì†¡ ëª…ë ¹ì–´ ìƒì„±
            // ğŸš¨ ì¤‘ìš”: ST ë‚´ë¶€ ìƒíƒœ ì´ˆê¸°í™”ì™€ ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒì„ ìœ ë„í•˜ëŠ” ëª…ë ¹ì–´
            // /run set_char: ì„ íƒëœ íŒŒíŠ¸ë„ˆ ìºë¦­í„°ë¡œ ì „í™˜
            // /run set_wits: ë¹„ì¸ê°„ê³„ WI ëª©ë¡ í™œì„±í™” (ì„ íƒ ì‚¬í•­)
            // /next_response: STì˜ ë‹¤ìŒ ì‘ë‹µ ìœ ë„ (ì±„íŒ… ì‹œì‘)
            const initialPrompt = `ë‹¹ì‹ ì€ ${partner.name}ì™€(ê³¼) í•¨ê»˜ í‡´ë§ˆ ì„ë¬´ë¥¼ ì‹œì‘í–ˆìŠµë‹ˆë‹¤. í”„ë¡¤ë¡œê·¸: "${partner.prologue}"ì— ì´ì–´ì„œ ìì—°ìŠ¤ëŸ½ê²Œ ì²« ëŒ€ì‚¬ë¥¼ ì‹œì‘í•˜ì„¸ìš”. ë‹¹ì‹ ì˜ ìºë¦­í„°ëŠ” ë‹¹ì‹ ì´ ì„ íƒí•œ íŒŒíŠ¸ë„ˆì™€ í•¨ê»˜ í˜„ì¥ì— ìˆìŠµë‹ˆë‹¤. ì´ ì„¸ì…˜ì€ ì´ì œ ì‹œìŠ¤í…œ ê¸°ë°˜ í”„ë¡¬í”„íŒ…ìœ¼ë¡œ ì§„í–‰ë˜ë©°, ëª¨ë“  ê²Œì„ ê¸°ëŠ¥(HP, ì •í™”ë„/ì˜¤ì—¼ë„, í„´ì œ, QTE ë“±)ì„ ì¶”í›„ AI ì‘ë‹µì— ë§ì¶° í™œì„±í™”í•  ì˜ˆì •ì…ë‹ˆë‹¤.`;
            
            // STì˜ JS Slash Runnerë¥¼ í†µí•´ ì‹¤í–‰í•  ìµœì¢… ëª…ë ¹ì–´ (í•œ ì¤„)
            const slashCommand = `/run set_char ${partnerId}; /run set_wits ${activeWitsString}; /next_response ${initialPrompt}`;
            
            alert(`
                âœ… ì‹œë®¬ë ˆì´ì…˜ ì„¤ì • ì™„ë£Œ ë° ST ì‘ë‹µ ìš”ì²­!
                
                íŒŒíŠ¸ë„ˆ: ${partner.name}
                í™œì„± WI: ${activeWitsString || 'ì—†ìŒ'}
                
                [ë‹¤ìŒ ë‹¨ê³„]
                1. ì´ ì•Œë¦¼ì„ ë‹«ê³  ST ì±„íŒ…ì°½ìœ¼ë¡œ ëŒì•„ê°€ì„¸ìš”.
                2. ST ì±„íŒ…ì°½ì— ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥ (ë˜ëŠ” JS Slash Runnerë¡œ ì‹¤í–‰)í•˜ì—¬ ì±„íŒ…ì„ ì‹œì‘í•˜ì„¸ìš”.
                
                **ST ì‹¤í–‰ ëª…ë ¹ì–´:** ${slashCommand}
            `);

            // í˜ì´ì§€ë¥¼ ë‹¤ì‹œ ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ë˜ëŒë¦½ë‹ˆë‹¤.
            showPage('page-1'); 
        }

        // ì´ˆê¸° ì‹œì‘
        document.addEventListener('DOMContentLoaded', () => {
            showPage('page-1');
            
            // ì™¸ë¶€ ë§í¬ ë²„íŠ¼ ì´ë²¤íŠ¸ (ìƒˆ ì°½ ì‹œë®¬ë ˆì´ì…˜)
            document.getElementById('externalLinkBtn').addEventListener('click', () => {
                alert("ì´ ë²„íŠ¼ì€ ì™¸ë¶€ HTML ë¬¸ì„œ(ì„¸ê³„ê´€, ìºë¦­í„° ìƒì„¸ ì„¤ëª…, ìƒì„¸ ê·œì¹™)ë¥¼ ìƒˆ ì°½ìœ¼ë¡œ ì—¬ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. ì‹¤ì œë¡œëŠ” ì´ í˜ì´ì§€ë¥¼ ST ì™¸ë¶€ì—ì„œ í˜¸ìŠ¤íŒ…í•´ì•¼ í•©ë‹ˆë‹¤.");
                // window.open('worldview.html', '_blank'); // ì‹¤ì œ êµ¬í˜„ ì‹œ ì‚¬ìš©
            });
        });

    </script>
</body>
</html>