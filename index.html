<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—‘ì†Œì‹œì¦˜ ì‹œë®¬ë ˆì´ì…˜: íŒŒíŠ¸ë„ˆ ì„ íƒ</title>
    <style>
/* -------------------------------------------
   A. ëª¨ë…¸í†¤ ì˜¤ì»¬íŠ¸ ìŠ¤íƒ€ì¼ (CSS) 
   ------------------------------------------- */
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Georgia', 'Malgun Gothic', serif; }

body {
    /* STì˜ iframe ë°°ê²½ìƒ‰ê³¼ ìœ ì‚¬í•˜ê²Œ íˆ¬ëª…í•˜ê²Œ ì„¤ì • */
    background: transparent; 
    color: #d8d8d8;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}

.selection-container {
    width: 90%; max-width: 900px; margin: 25px auto; padding: 40px;
    /* ì§™ì€ ë„¤ì´ë¹„ ë°°ê²½, ì˜¤ì»¬íŠ¸ ë¬´ë“œ */
    background: linear-gradient(135deg, rgba(15, 15, 26, 0.95) 0%, rgba(26, 26, 46, 0.95) 100%);
    border: 2px solid rgba(101, 85, 68, 0.6); border-radius: 12px;
    box-shadow: 0 0 40px rgba(0, 0, 0, 0.8), inset 0 0 30px rgba(240, 230, 140, 0.05), 0 0 60px rgba(101, 85, 68, 0.2);
    animation: fadeIn 1s ease-out; /* ë¡œë“œ ì‹œ í˜ì´ë“œì¸ */
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.title-header {
    color: #e8dcc8; text-align: center; margin-bottom: 15px;
    font-size: 2.5em; font-weight: 300; letter-spacing: 3px; line-height: 1.5;
    text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8), 0 0 15px rgba(232, 220, 200, 0.3);
    border-bottom: 1px solid rgba(232, 220, 200, 0.2); padding-bottom: 20px;
}

.subtitle-text {
    text-align: center; color: #a8a8a8; font-size: 0.95em; margin-bottom: 35px; line-height: 1.8;
}

.image-selection-container {
    display: flex; justify-content: space-around; margin-bottom: 20px; gap: 15px; flex-wrap: wrap;
}

/* ì´ë¯¸ì§€ ì˜ì—­ ìŠ¤íƒ€ì¼ */
.character-image-option {
    width: 23%; aspect-ratio: 1 / 1.4; 
    border: 2px solid rgba(101, 85, 68, 0.5); border-radius: 8px;
    transition: all 0.5s ease; cursor: pointer; position: relative; overflow: hidden;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.7);
    /* â— ì´ë¯¸ì§€ í´ë¦­ ìœ ë„ë¥¼ ìœ„í•œ ìµœì†Œ ë†’ì´ ë³´ì¥ */
    min-height: 250px; 
}

.character-image-option img {
    width: 100%; height: 100%; object-fit: cover;
    display: block;
    filter: grayscale(80%) brightness(0.6); 
    transition: all 0.5s ease;
}

/* Hover íš¨ê³¼: ìŠ¤í¬íŠ¸ë¼ì´íŠ¸ */
.character-image-option:hover img {
    filter: grayscale(0%) brightness(1.1);
}
.character-image-option:hover {
    border-color: rgba(232, 220, 200, 0.8); 
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.9), 0 0 30px rgba(232, 220, 200, 0.4); 
    transform: translateY(-8px) scale(1.04);
}

.character-option-label {
    position: absolute; bottom: 0; left: 0; right: 0;
    background: linear-gradient(180deg, transparent 0%, rgba(15, 15, 26, 0.9) 40%); 
    color: #d8d8d8; font-size: 0.9em;
    padding: 15px 8px 10px 8px; text-align: center;
    text-transform: uppercase; font-weight: 500;
    letter-spacing: 0.5px; transition: all 0.3s ease;
    z-index: 10;
}

.starter-button-main { 
    display: block; width: 70%; margin: 30px auto 15px auto;
    height: 60px; line-height: 60px;
    background: linear-gradient(135deg, rgba(70, 60, 50, 0.8) 0%, rgba(55, 45, 35, 0.8) 100%);
    border: 2px solid rgba(232, 220, 200, 0.5); border-radius: 8px;
    color: #e8dcc8; font-size: 1.1em; letter-spacing: 1.5px; text-transform: uppercase;
    transition: all 0.3s ease; cursor: pointer;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6), 0 0 20px rgba(232, 220, 200, 0.2);
    text-align: center;
}

.starter-button-main:hover {
    background: linear-gradient(135deg, rgba(90, 80, 70, 0.9) 0%, rgba(75, 65, 55, 0.9) 100%);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.8), 0 0 30px rgba(232, 220, 200, 0.4);
    transform: translateY(-4px) scale(1.01);
}

/* -------------------------------------------
   B. Iframe í†µì‹ ìš© JS í•¨ìˆ˜ 
   ------------------------------------------- */
function selectPartnerAndStart(partnerName, scenarioText) {
    // 1. EJS ë³€ìˆ˜ ì´ˆê¸°í™” ë° ì„¤ì • ëª…ë ¹ì–´ êµ¬ì„±
    const initVars = [
        `setvar('Partner_Name', '${partnerName}')`,
        `setvar('UserCurrentHP', 100)`,
        `setvar('UserMaxHP', 100)`,
        `setvar('Aff_Lucifer', 0)`,
        `setvar('DemonCurrentHP', 100)`,
        `setvar('CombatActive', 'OFF')`,
        `setvar('QTE_Active', 'OFF')`,
        `setvar('Item_Herb', 2)`
    ];
    
    // 2. ìµœì¢… ì‹¤í–‰ ëª…ë ¹ì–´: /run (ë³€ìˆ˜ ì„¤ì •) | /gen (ìŠ¤í† ë¦¬ ì‹œì‘)
    const initCommand = `/run <% ${initVars.join('; ')} %>`;
    const genCommand = `/gen "${scenarioText.replace(/"/g, '\\"')}"`;
    const finalCommand = `${initCommand} | ${genCommand}`;

    // 3. window.parent.postMessageë¥¼ ì‚¬ìš©í•˜ì—¬ ST ì°½ìœ¼ë¡œ ëª…ë ¹ì–´ ì „ì†¡
    window.parent.postMessage({
        type: 'ST_COMMAND',
        command: finalCommand
    }, '*'); // ì•ˆì „í•˜ì§€ ì•Šì§€ë§Œ, ST í™˜ê²½ì—ì„œëŠ” ì™€ì¼ë“œì¹´ë“œ ì‚¬ìš©
    
    // 4. ì¦‰ì‹œ í™”ë©´ ì „í™˜ ë° ì•ˆë‚´
    const container = document.querySelector('.selection-container');
    if(container) {
        container.innerHTML = `
            <h3 class="title-header" style="color:#10b981;">COMMAND SENT</h3>
            <p style="text-align:center; color:#c0c0c0;">íŒŒíŠ¸ë„ˆ ì„ íƒì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <p style="text-align:center; color:#e8dcc8; margin-top:15px;"><strong>ì±„íŒ…ì°½ì„ í™•ì¸í•˜ì‹­ì‹œì˜¤.</strong></p>
        `;
        container.style.boxShadow = '0 0 30px #10b981';
    }
}
</script>
</head>
<body>

<div class="selection-container">
    <div class="title-header">
        CHOOSE YOUR PARTNER
    </div>
    <p class="subtitle-text">
        ë‹¹ì‹ ì˜ ì²« ë²ˆì§¸ íŒŒíŠ¸ë„ˆë¥¼ ì„ íƒí•˜ì‹­ì‹œì˜¤. <br>
        <strong>í´ë¦­ ì¦‰ì‹œ ë³€ìˆ˜ ì´ˆê¸°í™”ì™€ í”„ë¡¤ë¡œê·¸ê°€ ì‹œì‘ë©ë‹ˆë‹¤.</strong>
    </p>
    
    <div class="image-selection-container">
        
        <div class="character-image-option" 
            style="background-image: url('\characters\partner_priest.jpg');"
            onclick="selectPartnerAndStart('ì‹ ë¶€ë‹˜', 'ë‹¹ì‹ ì€ ì‹ ë¶€ë‹˜(ì‰¬ì›€)ì„ íŒŒíŠ¸ë„ˆë¡œ ì„ íƒí–ˆìŠµë‹ˆë‹¤. [í”„ë¡¤ë¡œê·¸ 1: ì„±ìŠ¤ëŸ¬ìš´ ìˆ˜í˜¸ì™€ ìˆ¨ê²¨ì§„ ìƒí” ì‹œë‚˜ë¦¬ì˜¤ í…ìŠ¤íŠ¸]')">
            <img src="/characters/partner_priest.jpg" alt="ì‹ ë¶€ë‹˜">
            <div class="character-option-label">I. ì‹ ë¶€ë‹˜ (ì‰¬ì›€)</div>
        </div>
        
        <div class="character-image-option" 
            style="background-image: url('\characters\partner_shaman.jpg');"
            onclick="selectPartnerAndStart('ì£¼ìˆ ì‚¬', 'ë‹¹ì‹ ì€ ì£¼ìˆ ì‚¬(ë³´í†µ)ë¥¼ íŒŒíŠ¸ë„ˆë¡œ ì„ íƒí–ˆìŠµë‹ˆë‹¤. [í”„ë¡¤ë¡œê·¸ 2: ë„ì‹œì˜ ë¯¸ìŠ¤í„°ë¦¬ì™€ ê³„ì‚°ëœ ë™ë§¹ ì‹œë‚˜ë¦¬ì˜¤ í…ìŠ¤íŠ¸]')">
            <img src="/characters/partner_shaman.jpg" alt="ì£¼ìˆ ì‚¬">
            <div class="character-option-label">II. ì£¼ìˆ ì‚¬ (ë³´í†µ)</div>
        </div>
        
        <div class="character-image-option" 
            style="background-image: url('\characters\partner_successor.jpg');"
            onclick="selectPartnerAndStart('í›„ê³„ì', 'ë‹¹ì‹ ì€ í›„ê³„ì(ì–´ë ¤ì›€)ë¥¼ íŒŒíŠ¸ë„ˆë¡œ ì„ íƒí–ˆìŠµë‹ˆë‹¤. [í”„ë¡¤ë¡œê·¸ 3: ë¹„íš¨ìœ¨ì ì¸ ì™„ë²½ì£¼ì˜ì™€ ì˜¤ë§Œí•œ ê²½ë©¸ ì‹œë‚˜ë¦¬ì˜¤ í…ìŠ¤íŠ¸]')">
            <img src="/characters/partner_successor.jpg" alt="í›„ê³„ì">
            <div class="character-option-label">III. í›„ê³„ì (ì–´ë ¤ì›€)</div>
        </div>
        
        <div class="character-image-option" 
            style="background-image: url('\characters\partner_cultist.jpg');"
            onclick="selectPartnerAndStart('ìˆ­ë°°ì', 'ë‹¹ì‹ ì€ ìˆ­ë°°ì(ë§¤ìš° ì–´ë ¤ì›€)ë¥¼ íŒŒíŠ¸ë„ˆë¡œ ì„ íƒí–ˆìŠµë‹ˆë‹¤. [í”„ë¡¤ë¡œê·¸ 4: ê¸ˆì§€ëœ í˜¸ì¶œê³¼ ëˆˆì¹˜ ì—†ëŠ” ê´‘ì‹  ì‹œë‚˜ë¦¬ì˜¤ í…ìŠ¤íŠ¸]')">
            <img src="/characters/partner_cultist.jpg" alt="ìˆ­ë°°ì">
            <div class="character-option-label">IV. ìˆ­ë°°ì (ë§¤ìš° ì–´ë ¤ì›€)</div>
        </div>

    </div>
    
    <div style="text-align: center;">
        <div class="starter-button-main"
            onclick="selectPartnerAndStart('ëœë¤', 'Pause the roleplay. You are the GM. Randomly select one partner from (ì‹ ë¶€ë‹˜, ì£¼ìˆ ì‚¬, í›„ê³„ì, ìˆ­ë°°ì) and write the corresponding prologue based on the chosen partner. Do not reveal the partner\\\'s name until the end of the opening dialogue.')">
            [ V. ìš´ëª… ì£¼ì‚¬ìœ„ ğŸ² (ëœë¤ ì„ íƒ) ]
        </div>
    </div>
    
    <div class="description">
        * ì´ë¯¸ì§€ ë˜ëŠ” ë²„íŠ¼ í´ë¦­ ì¦‰ì‹œ ê²Œì„ì´ ì‹œì‘ë©ë‹ˆë‹¤.
    </div>
</div>
</body>
</html>